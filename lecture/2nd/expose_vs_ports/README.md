Docker Compose 파일에서 `expose`와 `ports`는 두 가지 다 컨테이너의 네트워크 포트 설정과 관련된 명령어입니다. 각각의 기능과 차이점을 아래와 같이 설명하고 예제를 통해 살펴보겠습니다.

### `expose`
- **목적**: `expose`는 해당 컨테이너가 사용하는 포트를 문서화하고, 동일한 Docker 내부 네트워크 내에서 다른 컨테이너들이 이 포트를 통해 연결할 수 있도록 합니다.
- **접근성**: 이 명령어로 노출된 포트는 외부에는 노출되지 않으며 오직 동일한 네트워크 내의 다른 컨테이너들만 접근할 수 있습니다.

### `ports`
- **목적**: `ports` 설정은 컨테이너의 포트를 호스트의 포트에 바인딩하여 외부 네트워크에서도 접근할 수 있게 합니다.
- **접근성**: 이 설정을 통해 지정된 호스트의 포트를 통해 컨테이너의 포트에 외부에서 직접 접근할 수 있습니다.

### 차이점
- **접근 범위**: `expose`는 내부 네트워크에서만 접근 가능하게 하며, `ports`는 외부 네트워크에서도 접근할 수 있도록 합니다.
- **용도**: 개발자는 `expose`를 사용해 다른 서비스들이 컨테이너와 통신할 수 있음을 명시할 수 있으며, `ports`는 실제로 외부 요청을 컨테이너로 라우팅할 때 사용됩니다.

### 예제
다음은 간단한 `docker-compose.yml` 파일 예제입니다. 여기서는 `web` 서비스가 `5000` 포트를 사용하고 이를 외부에 노출시키며, `db` 서비스는 `5432` 포트를 사용하지만 내부적으로만 노출합니다.

```yaml
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "8000:5000"
    depends_on:
      - db
  db:
    image: postgres
    expose:
      - "5432"
```

#### 설명
- **Web 서비스**:
  - 외부에서 `8000` 포트를 통해 접근하면, 이 요청은 내부적으로 `web` 컨테이너의 `5000` 포트로 매핑됩니다.
  - 외부 사용자는 `localhost:8000`을 통해 웹 서버에 접근할 수 있습니다.

- **DB 서비스**:
  - `5432` 포트는 내부 네트워크에만 노출되어 있어, `web` 서비스 같은 다른 서비스에서만 접근할 수 있습니다.
  - 외부에서는 직접적으로 `db` 서비스에 접근할 수 없습니다.

이 예제를 통해 `expose`와 `ports`의 차이를 명확히 이해하고 실습할 수 있습니다.

Docker Compose 파일을 사용하여 위의 예제를 실제로 테스트하기 위한 커맨드라인 명령어를 안내해 드리겠습니다. 먼저, 주어진 `docker-compose.yml` 파일을 사용할 준비가 되어 있어야 합니다.

### 1. Docker Compose 파일 작성
위에서 제공한 `docker-compose.yml` 파일 내용을 사용합니다. 이 파일을 작업할 디렉터리에 저장하세요.

### 2. Docker Compose 프로젝트 실행
Docker Compose 프로젝트를 실행하려면, 다음 커맨드를 사용합니다:
```bash
docker-compose up -d
```
이 명령은 Docker 컨테이너를 백그라운드 모드(`-d` 옵션 사용)에서 실행합니다.

### 3. 실행 중인 서비스 확인
실행 중인 모든 Docker 컨테이너를 확인하려면 다음 커맨드를 사용하세요:
```bash
docker-compose ps
```
이 명령은 현재 실행 중인 컨테이너와 그 상태를 보여줍니다.

### 4. 포트 노출 및 접근 확인
외부에서 `web` 서비스의 `8000` 포트를 통해 Nginx 홈페이지에 접근해 볼 수 있습니다. 웹 브라우저에서 `localhost:8000`을 방문하면 Nginx 홈페이지가 표시됩니다.

### 5. 내부 네트워크 통신 테스트
`web` 컨테이너에서 `db` 컨테이너의 `5432` 포트에 접근해보려면, 다음과 같은 커맨드를 사용할 수 있습니다:
```bash
docker-compose exec web bash
```
이 커맨드는 `web` 서비스의 쉘에 접속합니다. 그 다음, `psql`을 사용하여 `db` 서비스에 접근해 보세요 (PostgreSQL 클라이언트가 필요합니다):
```bash
psql -h db -U postgres
```
여기서 `-h db`는 `db` 서비스의 호스트 이름을, `-U postgres`는 사용자 이름을 지정합니다.

### 6. 정리
테스트가 끝나고 나면, 다음 커맨드로 모든 서비스를 중지하고 컨테이너를 제거할 수 있습니다:
```bash
docker-compose down
```

이러한 단계를 통해 실제로 `docker-compose.yml` 파일의 설정을 테스트하고, `expose`와 `ports`의 차이를 경험해 볼 수 있습니다.